{
    admin off
    auto_https off
}

:3000 {
    # GME - Google Maps Extractor
    handle /gme* {
        uri strip_prefix /gme
        reverse_proxy gme:8000
    }

    # WAHA Dashboard static files - browser loads from /dashboard/*
    handle /dashboard* {
        reverse_proxy waha:3000
    }

    # WAHA Swagger
    handle /swagger* {
        reverse_proxy waha:3000
    }

    # WAHA API - browser loads from /api/*
    handle /api* {
        reverse_proxy waha:3000
    }

    # WAHA health check
    handle /health* {
        reverse_proxy waha:3000
    }

    # WAHA entry - redirect to dashboard
    handle /waha {
        redir /dashboard/ permanent
    }
    handle /waha/ {
        redir /dashboard/ permanent
    }

    # Root - show available routes
    handle / {
        respond "MS Leads Proxy

Routes:
  /gme/*      -> Google Maps Extractor API
  /waha       -> WAHA Dashboard (redirects to /dashboard)
  /dashboard  -> WAHA Dashboard
  /api        -> WAHA API
  /swagger    -> WAHA Swagger
" 200
    }

    # Fallback
    handle {
        respond "Not Found" 404
    }
}
