# Caddy configuration with Let's Encrypt SSL
{
    email admin@vasilisa.at
}

# Global compression snippet (gzip level 5 - best speed/ratio balance)
(compression) {
    encode {
        gzip 5
        minimum_length 256
    }
}

# Twenty CRM (Production - Docker)
vasilisa.at {
    import compression
    reverse_proxy ms-twenty-server:3000
}

# Twenty CRM (Development - Native)
dev.vasilisa.at {
    import compression

    # Backend API endpoints
    handle /rest/* {
        reverse_proxy 172.18.0.1:3000
    }
    handle /graphql {
        reverse_proxy 172.18.0.1:3000
    }
    handle /metadata {
        reverse_proxy 172.18.0.1:3000
    }
    handle /files/* {
        reverse_proxy 172.18.0.1:3000
    }
    handle /auth/* {
        reverse_proxy 172.18.0.1:3000
    }
    handle /healthz {
        reverse_proxy 172.18.0.1:3000
    }
    handle /client-config {
        reverse_proxy 172.18.0.1:3000
    }
    handle /webhooks/* {
        reverse_proxy 172.18.0.1:3000
    }
    handle /open-api/* {
        reverse_proxy 172.18.0.1:3000
    }
    handle /mcp/* {
        reverse_proxy 172.18.0.1:3000
    }
    handle /s/* {
        reverse_proxy 172.18.0.1:3000
    }
    # Frontend (Vite dev server) - catch all remaining
    handle {
        reverse_proxy 172.18.0.1:3001
    }
}

# Chatwoot
chat.vasilisa.at {
    reverse_proxy ms-chatwoot-web:4000
}

# GME
gme.vasilisa.at {
    reverse_proxy ms-gme:8000
}

# WAHA
waha.vasilisa.at {
    reverse_proxy ms-waha:3000
}
